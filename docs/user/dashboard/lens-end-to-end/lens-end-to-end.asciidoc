[[lens-end-to-end]]
== Try it: Analyze the web logs data on a dashboard

With the web logs data, you want to find the answers to some key questions about your website traffic. 

[role="screenshot"]
image::images/lens_end_to_end_dashboard.png[Final dashboard vis] 

When you're finished, you know the answers to the following questions:

* How many users have visited my website?
* What’s the distribution of visitors by operating system?
* What’s the ratio of code responses over time?
* What’s the average bytes transfer per day? How does it relate to the number of visitors?
* What's the percentage of small vs big files transfer?
* How does website traffic look like hour by hour?
* Where does the traffic come from for top three countries?

[float]
[[add-the-sample-web-logs-data]]
=== Add the web logs data

To analyze the website traffic data, add the data set to {kib}.

. From the {kib} *Home* page, click *Try our sample data*.

. From *Sample web logs*, click *Add data*.

[float]
[[end-to-end-create-the-dashboard]]
=== Create the dashboard

Open the dashboard, then open the visualization builder. 

. Open the main menu, click *Dashboard*.

. Click *Create dashboard*.

[float]
[[metric-vis]]
=== View the number of website visitors

To view the number of users that have visited your website within the last 90 days, create a metric visualization.

. Click *Create panel*, then click *Lens* on the *New visualization* window.
+
[role="screenshot"]
image::images/lens_end_to_end_1_1.png[New visualization popover]

. Make sure the *kibana_sample_data_logs* index appears, then <<set-time-filter,set the time filter>> to *Last 90 days*.
+
[role="screenshot"]
image::images/lens_end_to_end_1_2.png[Index pattern switch and time picker]

. From the *Chart Type* dropdown, select *Metric*.

. From the *Available fields* list, drag and drop *clientip* on to the visualization builder.
+
[role="screenshot"]
image::images/lens_end_to_end_1_3.png[Changed type and dropped clientip field]

. From the editor, click *Unique count of clientip*.

.. Enter `Unique visitors` in the *Display name* field.

.. Click *Close*.
+
[role="screenshot"]
image::images/lens_end_to_end_1_4.png[Flyout config open]

. From the toolbar, click *Save*.

..  In the *Title* field, enter `Unique visitors`. 

.. Select *Add to dashboard after saving*.

.. Click *Save and return*.

[float]
[[donut-vis]]
=== Visualize the distribution of visitors by operating system

To determine the operating systems you should continue to support, and the importance of mobile traffic from iOS devices for your business, 
create a donut chart to view the top operating systems that your visitors use.

. From the dashboard, click *Create panel*, then click *Lens* on the *New visualization* window.

. Make sure the *kibana_sample_data_logs* index appears, and the <<set-time-filter,time filter>> is set to *Last 90 days*.

. From the *Chart Type* dropdown, select *Donut*.

. From the *Available fields* list, drag and drop *clientip* to the *Size by* field in the editor.

. From the *Available fields* list, drag and drop *machine.os.keyword* to the *Slice by* field in the editor.

. Change the color palette. 

.. From the editor, click *Top values of machine.os.keyword*. 

.. From the *Color palette* dropdown, select *Compability*.

.. Click *Close*.
+
[role="screenshot"]
image::images/lens_end_to_end_2_1.png[Donut chart with open config panel]

. From the toolbar, click *Save*.

..  In the *Title* field, enter `Visitors by OS`. 

.. Select *Add to dashboard after saving*.

.. Click *Save and return*.

[float]
[[mixed-multiaxis]]
=== Visualize the average bytes transfer per day

To optimize the cost of website maintenance and prevent potential server failures, create an area chart to monitor the average of bytes transfer, 
then add a line chart layer to compare the data to the number of visitors to your website.  

. From the dashboard, click *Create panel*, then click *Lens* on the *New visualization* window.

. Make sure the *kibana_sample_data_logs* index appears, and the <<set-time-filter,time filter>> is set to *Last 90 days*.

. From the *Available fields* list, drag and drop *bytes* on to the visualization builder.

. To zoom in on the data you want to view, click and drag your cursor across the bars. 

. From the editor, click *timestamp*.

.. Select *Customize time interval*.

.. Change the *Minimum interval* to `1 days`.
+
[role="screenshot"]
image::images/lens_end_to_end_3_1.png[Customize time interval]

.. Click *Close*.

. From the *Chart Type* dropdown, select *Area*.

[float]
[[add-a-data-layer]]
==== Add the line chart layer

To view the number of visitors to your website, add a line chart layer.

. From the editor, click *+*.
+
[role="screenshot"]
image::images/lens_end_to_end_3_2.png[Add new layer button]

. Click the *Chart type* dropdown, then click the line chart.
+
[role="screenshot"]
image::images/lens_end_to_end_3_3.png[Change layer type]
+
The chart type for the visualization changes to *Mixed XY*.

. From the *Available fields* list, drag and drop *timestamp* to the *Horizontal axis*.

. From the *Available fields* list, drag and drop *clientip* to the *Vertical axis*.

. From the editor, click *timestamp*.

.. Select *Customize time interval*.

.. Change the *Minimum interval* to `1 days`.

.. Click *Close*.

. From the editor, click *Unique count of clientip*.

.. In the *Display name* field, enter `Unique visitors`.

.. In the *Series color* field, enter *#CA8EAE*.

.. Click *Close*.

[float]
[[configure-the-multiaxis-chart]]
==== Configure the axes

The differences in the vertical axes value ranges makes the *Unique visitors* values difficult to read. To avoid this problem, add a separate axis for *Unique visitors*. 

. From the editor, click *Unique visitors* in the line chart layer.

. For *Axis side*, click *Right*.

When functions contain multiple formats, separate axes are created by default. 

. To change the *Average of bytes* formatting, click *Average of bytes* in the editor. 

. From the *Value format* dropdown, select *Bytes (1024)*. 
+
[role="screenshot"]
image::images/lens_end_to_end_3_4.png[Multiaxis chart]

. Click *Close*.

[float]
[[lens-legend-position]]
==== Change the legend position and save the visualization

You've finished the visualization, but the legend uses a lot of space. Change the position to the top of the chart, then save the visualization.

. From the *Legend* dropdown, select the top position.
+
[role="screenshot"]
image::images/lens_end_to_end_3_5.png[legend position]

. From the toolbar, click *Save*.

..  In the *Title* field, enter `Average Bytes vs. Unique Visitors`. 

.. Select *Add to dashboard after saving*.

.. Click *Save and return*.

[role="screenshot"]
image::images/lens_end_to_end_3_6.png[Multiaxis chart legend position]

[float]
[[percentage-stacked-area]]
=== Monitor the health of your website

To detect unusual traffic, or dead links and errors from the server, create a percentage stacked area chart that displays the response codes. 

Display the following response codes in the percentage stacked area chart:

* Successful responses (200-299)
* Redirects (300-399)
* Client errors (400-499)
* Server errors (500-599) 

. From the dashboard, click *Create panel*, then click *Lens* on the *New visualization* window.

. Make sure the *kibana_sample_data_logs* index appears.

. From the *Available fields* list, drag and drop *Records* to the *Vertical axis*.

. From the *Available fields* list, drag and drop *@timestamp* to the *Horizontal axis*.

. From *Break down by* in the editor, click *Drop a field or click to add*. 

.. From *Select a function*, click *Filters*.

.. Click *All records*, then enter `response.keyword>=200 AND response.keyword<300` in the *KQL* field. 

.. In the *Label* field, enter `2XX`.
+
[role="screenshot"]
image::images/lens_end_to_end_4_1.png[First filter in filters aggregation]

.. Click *Add a filter*, then repeat to add the following filters:

  ```
  response.keyword>=300 AND response.keyword<400
  response.keyword>=400 AND response.keyword<500
  response.keyword>=500 AND response.keyword<600
  ```
//+
//[role="screenshot"]
//image::images/lens_end_to_end_4_2.png[Filters]

.. From the *Color palette* dropdown, select *Status*.

.. Click *Close*.

. To remove the vertical axis label, click *Left axis*, then deselect *Show* next to *Axis name*.
+
[role="screenshot"]
image::images/lens_end_to_end_4_3.png[Turn off axis name]

. From the *Chart Type* dropdown, select *Percentage bar*.
+
[role="screenshot"]
image::images/lens_end_to_end_4_4.png[Responses codes chart]

. From the toolbar, click *Save*.

.. In the *Title* field, enter `Response Codes Over Time`. 

.. Select *Add to dashboard after saving*.

.. Click *Save and return*.

[float]
[[histogram]]
=== Monitor your website traffic per hour 

A histogram chart

Do you want to add a new post with the intention of reaching as many users as possible? 
Or do you need to make a change in your website that requires a short outage of your service? In both cases knowing an hourly website traffic distribution will help. 

. From the dashboard, click *Create panel*, then click *Lens* on the *New visualization* window.

. Make sure the *kibana_sample_data_logs* index appears.

. From the *Available fields* list, drag and drop *bytes* to *Vertical axis*.

. From the editor, click *Bytes*.

.. From *Select a function*, click *Sum*.

.. In the *Display name* field, enter `Transferred bytes`.

.. From the *Value format* dropdown, select `Bytes (1024)`.
+
[role="screenshot"]
image::images/lens_end_to_end_5_1.png[Vertical axis configuration]

. From the *Available fields* list, drag and drop *hour_of_day* to *Horizontal axis*.

. From the editor, click *hour_of_day*, then modify a slider *Intervals granularity* to get hourly intervals.
+
[role="screenshot"]
image::images/lens_end_to_end_5_2.png[Create custom ranges]

. From the toolbar, click *Save*.

.. In the *Title* field, enter `Hourly Traffic Distribution`. 

.. Select *Add to dashboard after saving*.

.. Click *Save and return*.

[float]
[[custom-ranges]]
===  Visualize the percentage of transfered file sizes 
 
To compare the amount of small versus large transfered files on your webpage, create a pie chart.

. From the dashboard, click *Create panel*, then click *Lens* on the *New visualization* window.

. Make sure the *kibana_sample_data_logs* index appears.

. From the *Available fields* list, drag and drop *bytes* to *Vertical axis* in the editor.

. From the editor, click *Average of bytes*.

.. From *Select a function*, click *Sum*.

.. Click *Close*.

. From the *Available fields* list, drag and drop *bytes* to *Break down by* in the editor.

. From the editor, click *bytes*.

.. From the *Value format* dropdown, select *Bytes (1024)*.

.. Click *Create custom ranges*, enter `0 -> 10240` in the *Ranges* field, then 
enter `Below 10KB` in the *Label* field. 

.. Click *Add range*, enter `10240 -> +∞` in the *Ranges* field, the enter `Above 10KB`in the *Label* field.
+
[role="screenshot"]
image::images/lens_end_to_end_6_1.png[Custom ranges configuration]
+
TIP: You can also use the *Filters* function to achieve the same results with <<kuery-query,KQL>> and <<lucene-query,Lucene>> filters.

. From the *Chart Type* dropdown, select *Pie*.
+
[role="screenshot"]
image::images/lens_end_to_end_6_2.png[Files size distribution]

. From the toolbar, click *Save*.

.. In the *Title* field, enter `File size distribution`. 

.. Select *Add to dashboard after saving*.

.. Click *Save and return*.

[float]
[[treemap]]
===  Visualize the top locations of your website traffic

Create a treemap that helps you determine the top three countries of your website traffic.

Through analysis, you can boost your business and reach out more audience. It gives you insights of which of your strategies work and which don't.

. From the dashboard, click *Create panel*, then click *Lens* on the *New visualization* window.

. Make sure the *kibana_sample_data_logs* index appears.

. From the *Chart Type* dropdown, select *Treemap*.

. From the *Available fields* list, drag and drop *Records* to *Size by* in the editor.

. From the *Group by* in the editor, click *Drop a field or click to add*.

.. From *Select a function*, click *Filters*.

.. Click *All records*, then enter `referer : *facebook.com*` in the *KQL* field. 

.. In the *Label* field, enter `Facebook`.

.. Click *Add a filter*, then repeat to add the following filters:

  ```
  KQL: `referer : *twitter.com*`, label: `Twitter`
  KQL: `NOT referer : *twitter* OR NOT referer: *facebook.com*`, label: `Other`
  ```
+
[role="screenshot"]
image::images/lens_end_to_end_7_1.png[Referers filters]

.. Click *Close*.

. To view the data from the top three countries, drag and drop *geo.src* from the *Available fields* list to the visualization builder. 

. To change the *Group by* order, click and drag *Top values of geo.src* so that it appears first in the editor.
+
[role="screenshot"]
image::images/lens_end_to_end_7_2.png[Treemap vis]

. To remove the *Other* category, click *Top values of geo.src* in the editor.

.. From the *Advanced* dropdown, deselect *Group other values as "Other"*.
+
[role="screenshot"]
image::images/lens_end_to_end_7_3.png[Group other values as Other]

.. Click *Close*.

. From the toolbar, click *Save*.

.. In the *Title* field, enter `Traffic Source For Top 3 Countries`. 

.. Select *Add to dashboard after saving*.

.. Click *Save and return*.

You've created a dashboard that gives you a full picture of your website data.

[role="screenshot"]
image::images/lens_end_to_end_dashboard.png[Final dashboard vis] 


